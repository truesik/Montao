<!DOCTYPE html>
<html lang="ru" xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/head :: head('Project Stack')"></head>
<body>
<!-- Channel Creation Modal Dialog -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body">
                <form th:action="@{__${#httpServletRequest.requestURI}__/channels/new}" method="post" id="new-channel">
                    <div class="form-group">
                        <label for="title" th:text="#{channel.title}">Title</label>
                        <input type="text" class="form-control" id="title" name="title" placeholder="Title"
                               th:placeholder="#{channel.title}">
                    </div>
                    <div class="form-group">
                        <label for="description" th:text="#{channel.description}">Description</label>
                        <input type="text" class="form-control" id="description" name="description"
                               placeholder="Description"
                               th:placeholder="#{channel.description}">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" id="create">Save changes</button>
            </div>
        </div>
    </div>
</div>

<div th:replace="fragments/navbar :: ${#authorization.expression('isAuthenticated()')}? 'signed-navbar' : 'notsigned-navbar'"></div>

<div class="container-fluid">
    <div class="row">
        <!--SIDEBAR-->
        <div class="col-md-3 sidebar">
            <span>Channels </span><a class="glyphicon glyphicon-plus" data-toggle="modal" href="#myModal"
                                     th:if="${#authorization.expression('isAuthenticated()')}"></a>
            <ul class="nav nav-sidebar">
                <li th:each="channel : ${channelList}">
                    <a href="#" th:text="${channel.title}">Channel</a>
                </li>
            </ul>
        </div>
        <!--CHAT-->
    </div>
</div>

<div th:replace="fragments/footer :: bootstrap-scripts"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function () {
        $('#create').click(function () {
            $('#new-channel').submit()
        });
        $('#new-channel').submit(function () {
            var channelForm = {
                title: $('#title').val(),
                description: $('#description').val()
            };
            var currentCommunity = $(location).attr('pathname');
            var csrfToken = /*[[${_csrf.token}]]*/ '';
            var csrfHeader = 'X-CSRF-TOKEN';
            var headers = {};
            headers[csrfHeader] = csrfToken;
            $.ajax({
                url: currentCommunity + '/channels/new',
                type: "POST",
                dataType: 'json',
                data: JSON.stringify(channelForm),
                contentType: "application/json",
                headers: headers,
                success: callback()
            });
            function callback(response) {
                console.log(response);
                if (response === 'success') {
                    console.log('yes')
                } else {
                    console.log('no')
                }
            }

            return false;
        })
    });
    /*]]>*/
</script>
</body>
</html>